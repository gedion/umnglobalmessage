define(["jquery"],function(a){return{settings:function(){var b=function(b){var c={},d="",e="";return a("#"+b+' input[name]:not([disabled]):not([type="checkbox"]),#'+b+" select:not([disabled]),#"+b+" textarea").each(function(){d=a(this).attr("name"),e=a(this).val(),c[d]=e}),a("#"+b+' input[type="checkbox"]').each(function(){d=a(this).attr("name"),e=a(this).prop("checked")?"1":"0",c[d]=e}),d="message[text]",e=a("#"+b+" div.editor_atto_content").html(),c[d]=e,c},c="",d=!1,e="",f=function(f,g,h,i,j){f.preventDefault(),f.stopPropagation();var k=M.cfg.wwwroot+"/local/umnglobalmessage/ajax_local_umnglobalmessage.php",l={action:h,id:i,sort:e,reverse:d,search:c,ajax:!0},m=function(){a("#local_umnglobalmessage_dialogue .content, #local_umnglobalmessage_table").css("opacity","0.6")},n=function(b){a("#local_umnglobalmessage_dialogue .content, #local_umnglobalmessage_table").css("opacity","1");var c=b,d=a.parseHTML(c.html);a("#local_umnglobalmessage_settings div#local_umnglobalmessage_table").html(d),a("span.error").length>0?a("span.error").focus():a("div.local_umnglobalmessage_error").length>0?a("div.local_umnglobalmessage_error").focus():a("input.local_umnglobalmessage_search").focus()};"POST"===g&&a.extend(l,b(j)),a.ajax({url:k,data:l,method:g,beforeSend:m,success:n,dataType:"json"})};a("body").delegate(".local_umnglobalmessage_button","click",function(b){var c=a(this).attr("data-id"),d=a(this).attr("data-action");f(b,"GET",d,c,null)}),a("body").delegate("table.generaltable tr th a","click",function(b){b.preventDefault(),b.stopPropagation();var c="sort";e=a(this).attr("id"),d=!1,a(this).find(".uparrow").length>0&&(d=!0),f(b,"GET",c,null,null)}),a("body").delegate(".bool-slider .inset","click",function(b){var c=a(this).attr("data-id");a(this).parent().hasClass("disabled")||(a(this).parent().hasClass("true")?(a(this).parent().addClass("false").removeClass("true"),f(b,"GET","disable",c,null)):(a(this).parent().addClass("true").removeClass("false"),window.location.href="/local/umnglobalmessage/ajax_local_umnglobalmessage.php?action=enable&id="+c))}),a("body").delegate("#local_umnglobalmessage_settings input.local_umnglobalmessage_search","input",function(b){c=a(this).val(),f(b,"GET","search",null,null)}),a("body").delegate("#local_umnglobalmessage_settings #local_umnglobalmessage_table tbody td.c0","mouseenter mouseleave",function(){var b=a(this).find(".local_umnglobalmessage_description");b.toggleClass("hidden"),window.innerHeight+a(window).scrollTop()<b.offset().top+b.height()?(a(this).prepend(b),b.css("margin-top",0-b.height())):(a(this).append(b),b.css("margin-top",0))})},message:function(){var b=a(".umngm"),c=1;if(b.length>0){var d=b.outerHeight()||0;(b.length>1||!b.hasClass("popup"))&&a("header .dropdown-panel").each(function(){var b=parseInt(a(this).css("top"),10),c=b+d;a(this).css("top",c)}),b.hasClass("popup")&&(a(".moodle-has-zindex").each(function(){var b=a(a(this)).css("zIndex")||a(a(this)).parent().css("zIndex");b&&parseInt(b,10)>c&&(c=parseInt(b,10))}),a(".umngm.popup").css("zIndex",c)),a("body").delegate(".umngm .umngm_close","click",function(){var b=M.cfg.wwwroot+"/local/umnglobalmessage/ajax_local_umnglobalmessage.php",c="POST",e={action:a(this).attr("data-action"),id:a(this).attr("data-id")};a.ajax({url:b,data:e,method:c,dataType:"json"}),a(this).closest(".umngm").animate({marginTop:0-d},.1,function(){a(this).closest(".umngm").remove(),a(this).closest(".umngm").hasClass("popup")||a("header .dropdown-panel").each(function(){a(this).css("top",parseInt(a(this).css("top"),10)-d)})})})}},form:function(){var b=a('select[name="target"]').val();"other"===b?(a('input[name="othertarget"]').removeAttr("disabled"),a('select[name="category"]').attr("disabled","disabled")):"category"===b?(a('input[name="othertarget"]').attr("disabled","disabled"),a('select[name="category"]').removeAttr("disabled")):(a('input[name="othertarget"]').attr("disabled","disabled"),a('select[name="category"]').attr("disabled","disabled"))}}});